<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Php-wechat : personal wechat sdk repos." />
    <meta name="auther" content="Light" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Php-wechat</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/lichunqiang/php-wechat">View on GitHub</a>

          <h1 id="project_title">Php-wechat</h1>
          <h2 id="project_tagline">personal wechat sdk repos.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/lichunqiang/php-wechat/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/lichunqiang/php-wechat/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="wechat-php-sdk" class="anchor" href="#wechat-php-sdk"><span class="octicon octicon-link"></span></a>wechat-php-sdk</h1>

<h3>
<a name="thanks-for-wechat-php-sdk" class="anchor" href="#thanks-for-wechat-php-sdk"><span class="octicon octicon-link"></span></a>Thanks for <a href="https://github.com/dodgepudding/wechat-php-sdk">wechat-php-sdk</a>
</h3>

<h2>
<a name="%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3" class="anchor" href="#%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3"><span class="octicon octicon-link"></span></a>使用详解</h2>

<p>使用前需先打开微信帐号的开发模式，详细步骤请查看微信公众平台接口使用说明：<br><a href="http://mp.weixin.qq.com/wiki/">http://mp.weixin.qq.com/wiki/</a></p>

<p>微信支付接入文档：
<a href="https://mp.weixin.qq.com/cgi-bin/readtemplate?t=business/course2_tmpl&amp;lang=zh_CN">https://mp.weixin.qq.com/cgi-bin/readtemplate?t=business/course2_tmpl&amp;lang=zh_CN</a></p>

<ol>
<li>wechat.class.php<br>
调用官方API，具有更灵活的消息分类响应方式，支持链式调用操作 ； </li>
</ol><h3>
<a name="%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD" class="anchor" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="octicon octicon-link"></span></a>主要功能</h3>

<ul>
<li>接入验证 （初级权限）</li>
<li>自动回复（文本、图片、语音、视频、音乐、图文）（初级权限）</li>
<li>菜单操作（查询、创建、删除）（菜单权限）</li>
<li>客服消息（文本、图片、语音、视频、音乐、图文）（认证权限）</li>
<li>二维码（创建临时、永久二维码，获取二维码URL）（认证权限）</li>
<li>分组操作（查询、创建、修改、移动用户到分组）（认证权限）</li>
<li>网页授权（基本授权，用户信息授权）（认证权限）</li>
<li>用户信息（查询用户基本信息、获取关注者列表）（认证权限）</li>
<li>媒体文件（上传、获取）（认证权限） </li>
<li>调用地址组件 （支付权限） </li>
<li>生成订单签名数据 （支付权限） </li>
<li>订单成功回调 （支付权限） </li>
<li>发货通知 （支付权限） </li>
<li>支付订单查询 （支付权限） </li>
</ul><h3>
<a name="%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8A%A8%E4%BD%9C" class="anchor" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8A%A8%E4%BD%9C"><span class="octicon octicon-link"></span></a>初始化动作</h3>

<div class="highlight highlight-php"><pre> <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'token'</span><span class="o">=&gt;</span><span class="s1">'tokenaccesskey'</span><span class="p">,</span> <span class="c1">//填写你设定的key</span>
    <span class="s1">'appid'</span><span class="o">=&gt;</span><span class="s1">'wxdk1234567890'</span><span class="p">,</span> <span class="c1">//填写高级调用功能的app id, 请在微信开发模式后台查询</span>
    <span class="s1">'appsecret'</span><span class="o">=&gt;</span><span class="s1">'xxxxxxxxxxxxxxxxxxx'</span><span class="p">,</span> <span class="c1">//填写高级调用功能的密钥</span>
    <span class="s1">'partnerid'</span><span class="o">=&gt;</span><span class="s1">'88888888'</span><span class="p">,</span> <span class="c1">//财付通商户身份标识，支付权限专用，没有可不填</span>
    <span class="s1">'partnerkey'</span><span class="o">=&gt;</span><span class="s1">''</span><span class="p">,</span> <span class="c1">//财付通商户权限密钥Key，支付权限专用</span>
    <span class="s1">'paysignkey'</span><span class="o">=&gt;</span><span class="s1">''</span> <span class="c1">//商户签名密钥Key，支付权限专用</span>
    <span class="p">);</span>
 <span class="nv">$weObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wechat</span><span class="p">(</span><span class="nv">$options</span><span class="p">);</span> <span class="c1">//创建实例对象</span>
 <span class="c1">//TODO：调用$weObj各实例方法</span>

</pre></div>

<p>新增Auth高级权限类方法:   </p>

<ul>
<li> checkAuth($appid,$appsecret) 此处传入公众后台高级接口提供的appid和appsecret, 函数将返回access_token操作令牌</li>
<li> createMenu($data) 创建菜单 $data菜单结构详见 <a href="http://mp.weixin.qq.com/wiki/index.php?title=%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3">http://mp.weixin.qq.com/wiki/index.php?title=%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3</a> </li>
<li> getMenu() 获取菜单 </li>
<li> deleteMenu() 删除菜单 </li>
<li> getMedia() 获取接收到的音频、视频媒体文件 </li>
<li> getQRCode($scene_id,$type=0,$expire=1800) 获取推广二维码ticket字串 </li>
<li> getQRUrl($ticket) 获取二维码图片地址</li>
<li> getUserList($next_openid) 批量获取关注用户列表 </li>
<li> getUserInfo($openid) 获取关注者详细信息 </li>
<li> getGroup() 获取用户分组列表 </li>
<li> createGroup($name) 新增自定分组 </li>
<li> updateGroup($groupid,$name) 更改分组名称 </li>
<li> updateGroupMembers($groupid,$openid) 移动用户分组<br>
</li>
<li> sendCustomMessage($data) 发送客服消息<br>
</li>
<li> getOauthRedirect($callback,$state,$scope) 获取网页授权oAuth跳转地址<br>
</li>
<li> getOauthAccessToken() 通过回调的code获取网页授权access_token<br>
</li>
<li> getOauthRefreshToken($refresh_token) 通过refresh_token对access_token续期<br>
</li>
<li> getOauthUserinfo($access_token,$openid) 通过网页授权的access_token获取用户资料<br>
</li>
<li> getSignature($arrdata,'sha1') 生成签名字串<br>
</li>
<li> generateNonceStr($length) 获取随机字串<br>
</li>
<li> createPackage($out_trade_no,$body,$total_fee,$notify_url,$spbill_create_ip,$fee_type=1,$bank_type="WX",$input_charset="UTF-8",$time_start="",$time_expire="",$transport_fee="",$product_fee="",$goods_tag="",$attach="") 生成订单package字符串<br>
</li>
<li> getPaySign($package, $timeStamp, $nonceStr) 支付签名(paySign)生成方法<br>
</li>
<li> checkOrderSignature($orderxml='') 回调通知签名验证<br>
</li>
<li> sendPayDeliverNotify($openid,$transid,$out_trade_no,$status=1,$msg='ok') 发货通知<br>
</li>
<li> getPayOrder($out_trade_no) 查询订单信息<br>
</li>
<li> getAddrSign($url, $timeStamp, $nonceStr, $user_token='') 获取收货地址JS的签名<br>
</li>
</ul><ol>
<li>
<p>wechatext.class.php<br>
非官方扩展API，需要配置公众平台账户和密码，能实现对已关注用户的点对点微信，此方式不保证长期有效。<br>
类方法里提及的用户id在接口返回结构里表述为FakeId, 属同一概念, 在下面wechatauth类里则表示为Uin, 用户id对应的微信号必须通过getInfo()方法通过返回数组的Username值获取, 但非关注关系用户资料不能获取.<br>
调用下列方法前必须经过login()方法和checkValid()验证方法才能获得调用权限. 有的账户无法通过登陆可能因为要求提供验证码, 可以手动登陆后把获取到的cookie写进程序存放cookie的文件解决.<br>
程序使用了经过修改的snoopy兼容式HTTP类方法, 在类似BAE/SAE云服务器上可能不能正常运行, 因为云服务的curl方法是经过重写的, 某些header参数如网站来源参数不被支持.<br>
类主要方法:</p>

<ul>
<li> send($id,$content) 向某用户id发送微信文字信息 </li>
<li> sendNews($id,$msgid) 发送图文消息, 可通过getNewsList获取$msgid</li>
<li> getUserList($page,$pagesize,$groupid) 获取用户信息</li>
<li> getGroupList($page,$pagesize) 获取群组信息</li>
<li> getNewsList($page,$pagesize) 获取图文信息列表 </li>
<li> uploadFile($filepath,$type) 上传附件,包括图片/音频/视频</li>
<li> getFileList($type,$page,$pagesize) 获取素材库文件列表</li>
<li> sendImage($id,$fid) 发送图片消息</li>
<li> sendAudio($id,$fid) 发送音频消息</li>
<li> sendVideo($id,$fid) 发送视频消息 </li>
<li> getInfo($id) 根据id获取用户资料,注: 非关注关系用户资料不能获取<br>
</li>
<li> getNewMsgNum($lastid) 获取从$lastid算起新消息的数目<br>
</li>
<li> getTopMsg() 获取最新一条消息的数据, 此方法获取的消息id可以作为检测新消息的$lastid依据<br>
</li>
<li> getMsg($lastid,$offset=0,$perpage=50,$day=0,$today=0,$star=0) 获取最新的消息列表, 列表将返回消息id, 用户id, 消息类型, 文字消息等参数<br>
</li>
<li> 消息返回结构:  {"id":"消息id","type":"类型号(1为文字,2为图片,3为语音)","fileId":"0","hasReply":"0","fakeId":"用户uid","nickName":"昵称","dateTime":"时间戳","content":"文字内容"}<br>
</li>
<li> getMsgImage($msgid,$mode='large') 若消息type类型为2, 调用此方法获取图片数据<br>
</li>
<li> getMsgVoice($msgid) 若消息type类型为3, 调用此方法获取语音数据<br>
</li>
</ul>
</li>
<li>
<p>wechatauth.class.php<br>
通过微信二维码登陆微信的API, 能实现第三方网站同步登陆, 首先程序分别通过get_login_code和get_code_image方法获取授权二维码图片, 然后利用微信手机客户端扫描二维码图片后将自动跳出授权页面, 用户点击授权后即可获取对应的用户资料和头像信息. 详细验证步骤请看test3.php例子.<br>
类主要方法:</p>

<ul>
<li> get_login_code() 获取登陆授权码, 通过授权码才能获取二维码<br>
</li>
<li> get_code_image($code='') 将上面获取的授权码转换为图片二维码<br>
</li>
<li> verify_code() 鉴定是否登陆成功,返回200为最终授权成功.<br>
</li>
<li> get_login_cookie() 鉴定成功后调用此方法即可获取用户基本信息<br>
</li>
<li> sendNews($account,$title,$summary,$content,$pic,$srcurl='') 向一个微信账户发送图文信息<br>
</li>
<li> get_avatar($url) 获取用户头像图片数据<br>
</li>
<li> logout() 注销登陆<br>
</li>
</ul>
</li>
<li>
<p>wechat.js
微信内嵌网页特殊功能js调用：</p>

<ul>
<li>WeixinJS.hideOptionMenu() 隐藏右上角按钮</li>
<li>WeixinJS.hideToolbar() 隐藏工具栏</li>
<li>通过定义全局变量dataForWeixin配置触发分享的内容：</li>
</ul>
<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">dataForWeixin</span><span class="o">=</span><span class="p">{</span>
     <span class="nx">appId</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
     <span class="nx">MsgImg</span><span class="o">:</span><span class="s2">"消息图片路径"</span><span class="p">,</span>
     <span class="nx">TLImg</span><span class="o">:</span><span class="s2">"时间线图路径"</span><span class="p">,</span>
     <span class="nx">url</span><span class="o">:</span><span class="s2">"分享url路径"</span><span class="p">,</span>
     <span class="nx">title</span><span class="o">:</span><span class="s2">"标题"</span><span class="p">,</span>
     <span class="nx">desc</span><span class="o">:</span><span class="s2">"描述"</span><span class="p">,</span>
     <span class="nx">fakeid</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
     <span class="nx">callback</span><span class="o">:</span><span class="kd">function</span><span class="p">(){}</span>
  <span class="p">};</span>
</pre></div>
</li>
</ol><h2>
<a name="%E5%AE%98%E6%96%B9wechat%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B" class="anchor" href="#%E5%AE%98%E6%96%B9wechat%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="octicon octicon-link"></span></a>官方Wechat调用示例：</h2>

<div class="highlight highlight-php"><pre><span class="c1">//test1.php</span>
<span class="k">include</span> <span class="s2">"wechat.class.php"</span><span class="p">;</span>
<span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'token'</span><span class="o">=&gt;</span><span class="s1">'tokenaccesskey'</span> <span class="c1">//填写你设定的key</span>
    <span class="p">);</span>
<span class="nv">$weObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wechat</span><span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
<span class="nv">$weObj</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">();</span> <span class="c1">//注意, 应用验证通过后,可将此句注释掉, 但会降低网站安全性</span>
<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$weObj</span><span class="o">-&gt;</span><span class="na">getRev</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getRevType</span><span class="p">();</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">MSGTYPE_TEXT</span><span class="o">:</span>
            <span class="nv">$weObj</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s2">"hello, I'm wechat"</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">reply</span><span class="p">();</span>
            <span class="k">exit</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">MSGTYPE_EVENT</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">Wechat</span><span class="o">::</span><span class="na">MSGTYPE_IMAGE</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
            <span class="nv">$weObj</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s2">"help info"</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">reply</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="%E6%89%A9%E5%B1%95%E5%8C%85wechatext%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B-" class="anchor" href="#%E6%89%A9%E5%B1%95%E5%8C%85wechatext%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B-"><span class="octicon octicon-link"></span></a>扩展包Wechatext调用示例: </h2>

<div class="highlight highlight-php"><pre><span class="c1">//test2.php </span>
    <span class="k">include</span> <span class="s2">"wechatext.class.php"</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">logdebug</span><span class="p">(</span><span class="nv">$text</span><span class="p">){</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'./data/log.txt'</span><span class="p">,</span><span class="nv">$text</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="nx">FILE_APPEND</span><span class="p">);</span>     
    <span class="p">};</span>

    <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'account'</span><span class="o">=&gt;</span><span class="s1">'demo@domain.com'</span><span class="p">,</span>
        <span class="s1">'password'</span><span class="o">=&gt;</span><span class="s1">'demo'</span><span class="p">,</span>
        <span class="s1">'datapath'</span><span class="o">=&gt;</span><span class="s1">'./data/cookie_'</span><span class="p">,</span>
            <span class="s1">'debug'</span><span class="o">=&gt;</span><span class="k">true</span><span class="p">,</span>
            <span class="s1">'logcallback'</span><span class="o">=&gt;</span><span class="s1">'logdebug'</span>   
    <span class="p">);</span> 
    <span class="nv">$wechat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wechatext</span><span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">checkValid</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// 获取用户信息</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">getInfo</span><span class="p">(</span><span class="s1">'3974255'</span><span class="p">);</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
        <span class="c1">// 获取最新一条消息</span>
        <span class="nv">$topmsg</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">getTopMsg</span><span class="p">();</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$topmsg</span><span class="p">);</span>
        <span class="c1">// 主动回复消息</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$topmsg</span> <span class="o">&amp;&amp;</span> <span class="nv">$topmsg</span><span class="p">[</span><span class="s1">'has_reply'</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$topmsg</span><span class="p">[</span><span class="s1">'fakeid'</span><span class="p">],</span><span class="s1">'hi '</span><span class="o">.</span><span class="nv">$topmsg</span><span class="p">[</span><span class="s1">'nick_name'</span><span class="p">]</span><span class="o">.</span><span class="s1">',rev:'</span><span class="o">.</span><span class="nv">$topmsg</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]);</span> 
    <span class="p">}</span>
</pre></div>

<h2>
<a name="%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81wechatauth%E7%99%BB%E9%99%86%E7%A4%BA%E4%BE%8B-" class="anchor" href="#%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81wechatauth%E7%99%BB%E9%99%86%E7%A4%BA%E4%BE%8B-"><span class="octicon octicon-link"></span></a>微信二维码Wechatauth登陆示例: </h2>

<div class="highlight highlight-php"><pre><span class="c1">//test3.php</span>
    <span class="k">include</span> <span class="s2">"../wechatauth.class.php"</span><span class="p">;</span>
    <span class="nb">session_start</span><span class="p">();</span>
    <span class="nv">$sid</span>  <span class="o">=</span> <span class="nb">session_id</span><span class="p">();</span>
    <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'account'</span><span class="o">=&gt;</span><span class="nv">$sid</span><span class="p">,</span>
        <span class="s1">'datapath'</span><span class="o">=&gt;</span><span class="s1">'../data/cookiecode_'</span><span class="p">,</span>
    <span class="p">);</span> 
    <span class="nv">$wechat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wechatauth</span><span class="p">(</span><span class="nv">$options</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'code'</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$logincode</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'code'</span><span class="p">];</span>
        <span class="nv">$vres</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">set_login_code</span><span class="p">(</span><span class="nv">$logincode</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">verify_code</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$vres</span><span class="o">===</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'status'</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'status'</span><span class="o">=&gt;</span><span class="nv">$vres</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$vres</span><span class="o">==</span><span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$result</span><span class="p">[</span><span class="s1">'info'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">get_login_info</span><span class="p">();</span>
                <span class="nv">$result</span><span class="p">[</span><span class="s1">'cookie'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">get_login_cookie</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">die</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$result</span><span class="p">));</span>  
    <span class="p">}</span>
    <span class="nv">$logincode</span> <span class="o">=</span>  <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">get_login_code</span><span class="p">();</span> <span class="c1">//获取授权码</span>
    <span class="nv">$qrimg</span> <span class="o">=</span> <span class="nv">$wechat</span><span class="o">-&gt;</span><span class="na">get_code_image</span><span class="p">();</span> <span class="c1">//待输出的二维码图片</span>
</pre></div>

<p>HTML部分请看test/test3.php, 主要是定时ajax查询是否已经授权成功</p>

<h4>
<a name="change-log" class="anchor" href="#change-log"><span class="octicon octicon-link"></span></a>Change Log</h4>

<hr><p>2014.04.19</p>

<ul>
<li>新增cache接口，用户缓存access_token等信息</li>
<li>新增Wechat::uploadArticle($articles)上传图文素材</li>
<li>新增Wechat::massSendByGroup($media_id, $group_id)根据分组ID群发消息</li>
<li>新增Wechat::massSendByOpenId($media_id, $openid_list)根据用户OPENID群发消息</li>
<li>新增Wechat::massDelete($msg_id)删除群发消息</li>
<li>引入php_fast_cace.php作为cache类库</li>
<li>增加菜单相关示例</li>
<li>增加二维码相关示例</li>
<li>增加用户相关示例</li>
</ul><p>2014.04.21</p>

<ul>
<li>修改<code>http_post</code>方法，增加<code>$is_upload</code>方法，是否为上传文件</li>
<li>新增Wechat::uploadMedia($media_source, $type)上传多媒体文件<a href="http://mp.weixin.qq.com/wiki/index.php?title=%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD%E5%A4%9A%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6">文档</a>
</li>
<li>增加高级群发接口测试文件</li>
<li>修改群发相关BUG</li>
<li>新增帮助文件<code>wechat.helper.php</code>
</li>
</ul><p>2014.04.23</p>

<ul>
<li>增加Wechat::getUserGroup($openid) 根据用户的openid获取用户所在分组</li>
</ul><h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>This is licensed under the GNU LGPL, version 2.1 or later.<br>
For details, see: <a href="http://creativecommons.org/licenses/LGPL/2.1/">http://creativecommons.org/licenses/LGPL/2.1/</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Php-wechat maintained by <a href="https://github.com/lichunqiang">lichunqiang</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
